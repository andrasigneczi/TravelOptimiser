<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>
        Price statistic
    </title>
    <script src="/js/highcharts/jquery-1.12.0/jquery.min.js"></script>
    <script src="/js/highcharts/highcharts-4.2.3.js"></script>
    <script src="/js/highcharts/exporting-4.2.3.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="/js/bootstrap/bootstrap.min.js"></script>

    <link rel="stylesheet" type="text/css" href="/css/traveloptimizer.css" title="Style">
</head>
<body>
<script>
    var TO_ActionName   = null;
    var TO_ActionValue  = null;
    var TO_ActionWidget = null;
</script>

<div class="TO_row">
    <label>Select departure airport: </label>
    [DEPARTURE_AIRPORTS]
    <span></span>
    <input type="button" name="switchtheairports" value="<=>" />
    <span></span>
    <label>Select arrival airport: </label>
    [ARRIVAL_AIRPORTS]
    <br/>
    <input type="checkbox" name="ReturnTrip" value="1" />
    <label> Return trip: </label>
</div>

<div class="TO_row" id="AvailableTrips">
[AVAILABLE_TRIPS]
</div>

[CHART_DIVS]

<script lang="JavaScript">
    [CHART_SCRIPTS]
</script>

<form action="/ajaxrequest" id="ajaxform" method="POST">
</form>

<!-- the result of the search will be rendered inside this div -->
<div id="ajaxresult"></div>

<!-- Trigger the modal with a button -->
<button id="OpenModalButton" type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal" style="visibility:hidden">Open Modal</button>

<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-xxl">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Modal Header</h4>
            </div>
            <div class="modal-body" id="ModalWindowBody">
                <p>Some text in the modal.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

<script>
    // Attach a submit handler to the form
    $( "#ajaxform" ).submit(function( event ) {

    // Stop form from submitting normally
    event.preventDefault();

    // Get some values from elements on the page:
    var $form = $( this )

    var lParam = null;
    if( TO_ActionName == 'DepartureAirportListChanged' ||
        TO_ActionName == 'ArrivalAirportListChanged')
    {
        lParam = TO_ActionWidget.options[TO_ActionWidget.selectedIndex].value;
    }
    else if( TO_ActionName == 'DateTimeButtonPushed' )
    {
        var lS1 = document.getElementById( 'DepartureAirportList' );
        var lS2 = document.getElementById( 'ArrivalAirportList' );
        var lSelected1 = lS1.options[lS1.selectedIndex].value;
        var lSelected2 = lS2.options[lS2.selectedIndex].value;
        lParam = TO_ActionValue + '|' + TO_ActionWidget.value + '|' + lSelected1 + '|' + lSelected2;
        //alert( lParam );
    }

    lURL = $form.attr( "action" );

    // Send the data using post
    var posting = $.post( lURL, { id: TO_ActionName, param: lParam } );

    // Put the results in a div
    posting.done(function( data ) {
        if( TO_ActionName == 'DepartureAirportListChanged' ||
            TO_ActionName == 'ArrivalAirportListChanged')
        {
            $("#AvailableTrips").html( data );
        }
        else if( TO_ActionName == 'DateTimeButtonPushed' )
        {
            $("#ModalWindowBody").html( data );
            $("#OpenModalButton" ).click();
            ModalRefresh();
        }
    });
});

function ModalRefresh()
{
    var chart = $('#modalcontainer').highcharts();
    $('#myModal').on('show.bs.modal', function() {
        $('#modalcontainer').css('visibility', 'hidden');
    });
    $('#myModal').on('shown.bs.modal', function() {
        $('#modalcontainer').css('visibility', 'initial');
        chart.reflow();
    });
}

</script>
</body>
</html>